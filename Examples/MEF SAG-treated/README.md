# ![CiliaQ](https://github.com/hansenjn/CiliaQ/blob/master/Webfiles/20200618%20CiliaQ%20Logo%20Small.png?raw=true) [Examples](https://github.com/hansenjn/CiliaQ/tree/master/Examples)
To test and try CiliaQ, we here provide images from the data-sets presented in the [CiliaQ publication](https://dx.doi.org/10.1140/epje/s10189-021-00031-y).

## Example: Confocal microscopy image of cultured cells
Here you find an example confocal 3D image ("MEF_SAG-treated_Example.tif") of Mouse Embryonic Fibroblasts (MEFs) stimulated 24 h prior to fixation with 1 ÂµM Smoothened Agonist (SAG) and stained with DAPI (channel 1), a Smoothened antibody to label Smoothened translocation to the primary cilium (channel 2), and an ARL13B antibody to label cilia (channel 3). We analyzed the image using CiliaQ as explained in the following sections.

Note: The .tif-file presented was cropped from a larger image to reduce the file size - original image below.

<p align="center">
   <img src="https://github.com/hansenjn/CiliaQ/blob/master/Webfiles/Example%20webfiles/MEF_SAG-treated_Example_WholeImage.png" width=400>
   <br>
   <i>Maximum-intensity-projection of the original image from which the example image was cropped. Cropped region outlined in white. (c) Hansen et al. (https://dx.doi.org/10.1140/epje/s10189-021-00031-y) </i>
</p>

### 1. CiliaQ Preparator

We processed the image with CiliaQ Preparator as follows. We selected the settings based on testing different segmentation methods manually (for more details on how to test and find segmentation settings for CiliaQ Preparator, have a look at the [CiliaQ wiki](https://github.com/hansenjn/CiliaQ/wiki)).

- We launched CiliaQ Preparator via the menu entry Plugins > CiliaQ > CiliaQ Preparator.
- We confirmed the first dialog.

<p align="center">
   <img src="https://github.com/hansenjn/CiliaQ/blob/master/Webfiles/Example%20webfiles/MEF_SAG-treated_Example_CQP_1.png" width=400>
</p>

- In the second dialog we selected the channel number 3 (because this was the channel containing the cilium labeling based on an ARL13B antibody) and we chose the threshold algorithm *Triangle*.

<p align="center">
   <img src="https://github.com/hansenjn/CiliaQ/blob/master/Webfiles/Example%20webfiles/MEF_SAG-treated_Example_CQP_2.png" width=700>
</p>

- In the upcoming Multi-File-Manager dialog, which allows to select the files that shall be processed, we selected the image file ("MEF_SAG-treated_Example.tif").

<p align="center">
   <img src="https://github.com/hansenjn/CiliaQ/blob/master/Webfiles/Example%20webfiles/MEF_SAG-treated_Example_CQP_3.png" width=400>
</p>

- When the processing is done, the progress bar of the Multi-Task-Manager shows "analysis done!".

<p align="center">
   <img src="https://github.com/hansenjn/CiliaQ/blob/master/Webfiles/Example%20webfiles/MEF_SAG-treated_Example_CQP_4.png" width=400>
</p>

- CiliaQ Preparator output a CQP.tif file, which contains an additional channel  that is segmented. The original channel 3 is still available (now in channel 4). We colored the segmented channel in cyan to assess how good the segmentation performed as follows: 
   - Select Image > Color > Channels tool in the menu, revealing the "Channels" dialog.
   - Select the segmented channel using the C bar on bottom of the image.
   - In the "Channels" dialog, select More >> cyan.
   - Open the Brightness & Contrast ("B&C") dialog and adjust the "maximum" slider to better visualize the "mask" channel. By also changing the original channel  from which the segmentation was derived (select the 4th channel in the "Z" slider on the bottom of the image window and adjust the "maximum" slider in the "B&C" dialog), you may create a visualization of the stack that allows to assess whether the objects generated by segmentation represent cilia. 

<p align="center">
   <img src="https://github.com/hansenjn/CiliaQ/blob/master/Webfiles/Example%20webfiles/MEF_SAG-treated_Example_CQP_5.png" width=800>
   <br>
   <br>
   <img src="https://github.com/hansenjn/CiliaQ/blob/master/Webfiles/Example%20webfiles/MEF_SAG-treated_Example_CQP_6.png" width=400>
   <img src="https://github.com/hansenjn/CiliaQ/blob/master/Webfiles/Example%20webfiles/MEF_SAG-treated_Example_CQP_7.png" width=400>
</p>

- Because the segmentation worked well and we did not see any incorrectly segmented cilia, editing with CiliaQ Editor was not necessary. Thus, we could directly proceed to the plugin CiliaQ.

### 2. CiliaQ
We next used CiliaQ under the following settings to analyze the cilia. In turn, CiliaQ revealed the other output files.

- We launched CiliaQ via the menu entry: Plugins > CiliaQ > CiliaQ.
- A dialog appeared for setting general settings. Confirm.

<p align="center">
   <img src="https://github.com/hansenjn/CiliaQ/blob/master/Webfiles/Example%20webfiles/MEF_SAG-treated_Example_CQP_8.png" width=500>
</p>

- A new dialog appeared to set additional settings. 
   - We checked "measure intensity A" and "measure intensity B" because we wanted to retrieve intensity information from two channel: the SMO channel (channel nr 2 in the CQP.tif file) and the unsegmented ARL13B channel (channel nr 4 in the CQP.tif file). 
   - Accordingly, we defined in the "reconstruction" channel field the segmented channel ("3"), in the "intensity A" field the SMO channel ("2"), and in the "intensity B" field the raw ARL13B channel ("4").
   - We additionally unselected the "increase range" options, because we did not expect any noisy cilia in the image where two segments would need to be linked.
   - We reduced the Gauss XY sigma slightly to 1.0 because we found in previous analysis that this yielded a good ciliary centerline tracking. 
   - Finally, we pressed "OK" to launch the analysis.

<p align="center">
   <img src="https://github.com/hansenjn/CiliaQ/blob/master/Webfiles/Example%20webfiles/MEF_SAG-treated_Example_CQP_9.png" width=800>
</p>

- In the next dialog, we added the CQP.tif file produced by CiliaQ Preparator to the list of files that shall be processed.

<p align="center">
   <img src="https://github.com/hansenjn/CiliaQ/blob/master/Webfiles/Example%20webfiles/MEF_SAG-treated_Example_CQP_10.png" width=400>
</p>

- We pressed start processing to run the softare - the Multi-Task-Manager dialog shows the progress:

<p align="center">
   <img src="https://github.com/hansenjn/CiliaQ/blob/master/Webfiles/Example%20webfiles/MEF_SAG-treated_Example_CQP_11.png" width=400>
</p>

- When the analysis is finished, the dialog shows "analysis done!" and the output files are saved.

<p align="center">
   <img src="https://github.com/hansenjn/CiliaQ/blob/master/Webfiles/Example%20webfiles/MEF_SAG-treated_Example_CQP_12.png" width=400>
</p>

- In the output files of a CiliaQ analysis, you should inspect the RP_3D.png file and/or the RP.png file. Here you can inspect what kind of objects have been detected as cilia. 

<p align="center">
   <img src="https://github.com/hansenjn/CiliaQ/blob/master/Webfiles/Example%20webfiles/MEF_SAG-treated_Example_CQP_CQ_RP_3D.png" width=400>
   <hspace>
   <img src="https://github.com/hansenjn/CiliaQ/blob/master/Webfiles/Example%20webfiles/MEF_SAG-treated_Example_CQP_13.png" width=400>
</p>

- You may see that two objects were detected (cilium with ID "8" and cilium with ID "12") that are particularly small and thus, may not represent cilia. In case you would not consider these objects to be cilia in your analysis, you may wish to remove these cilia - here, three options would be available:

1. In your post-hoc analysis you could exclude the cilia with ID "8" and "12".
2. In your post-hoc analysis you could exclude all cilia that do not exceed a certain size - this would be an option to be applicable also to other images that you do not inspect.
3. You could rerun CiliaQ on the CQP.tif file with an increased "minimum cilium size" threshold and also apply this threshold for other images of the same data set. 
 
As a concluding note: To find a good "minimum cilium size" size threshold, you may look into the voxel numbers of the detected cilia. To this end, you could, e.g., copy the tab-delimited text file with ending "CQ.txt" from your analysis (here "MEF_SAG-treated_Example_CQP_CQ.txt") into an excel sheet and have a look at the column revealing the "volume [voxel]" of the individual cilia. Here you can see that the cilia with ID "8" and "13" were only 12 and 15 voxel, respectively, large. In contrast, all other detected cilia were above 100 voxel. You could thus pick a "minimum cilium size" for your analysis of at least 20 or even 100 to rerun CiliaQ on the image or to filter out objects that are too small in the output data.

<p align="center">
   <img src="https://github.com/hansenjn/CiliaQ/blob/master/Webfiles/Example%20webfiles/MEF_SAG-treated_Example_CQP_14.png" width=700>
</p>

## Copyright, licenses, and more information
(c) Hansen et al. (https://doi.org/10.1101/2020.09.28.317065) 

CiliaQ represents a set of three ImageJ plugins to quantify ciliary shape, length, and fluorescence in 2D, 3D, and 4D images. Visit [main page](https://github.com/hansenjn/CiliaQ) of the repository for more information, such as how to [use](https://github.com/hansenjn/CiliaQ#using-ciliaq), [cite](https://github.com/hansenjn/CiliaQ#how-to-cite), [report ideas, issues, improve](https://github.com/hansenjn/CiliaQ#ideas-missing-functions-issues-bugs-unclear-in-the-user-guide) CiliaQ. 
